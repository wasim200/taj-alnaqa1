# PROJECT CORE MEMORY

## 1. فكرة المشروع
نظام "تاج النقاء" هو منصة إلكترونية لإدارة مسابقات وسحوبات الجوائز عبر كروت الخدش، تهدف لتعزيز ولاء العملاء وزيادة مبيعات المنتجات (الكبيرة والصغيرة) من خلال منح فرص فوز فورية ومؤجلة.

## 2. المشكلة التي يعالجها
- صعوبة إدارة السحوبات الورقية التقليدية وضمان نزاهتها.
- الحاجة للتحقق الآلي من صحة الأكواد ومنع تكرار استخدامها.
- تجميع بيانات العملاء (أرقام الهواتف) بشكل منظم لإعادة استهدافهم لاحقاً.

## 3. الهدف الأساسي
توفير نظام آمن وسهل الاستخدام يتيح للعملاء تسجيل أكوادهم للدخول في السحب، ويمكن الإدارة من توليد الأكواد، التحكم في البيانات، واختيار الفائزين بشفافية.

## 4. أنواع المستخدمين وصلاحياتهم
1. **المسؤول (Admin):**
   - الوصول للوحة التحكم (`/admin/dashboard`).
   - توليد أكواد جديدة وتحديد نوعها ودفعاتها (`/admin/generate`).
   - مشاهدة الإحصائيات والمشتركين (`/api/admin/stats`).
   - إجراء السحب العشوائي (`/admin/winner`).
   - إعادة تهيئة النظام/حذف البيانات (`/api/admin/reset`).
2. **المشترك (Participant):**
   - مستخدم عام يصل للصفحة الرئيسية (`/`).
   - يسجل بياناته (الاسم، الهاتف) والكود للدخول في السحب.

## 5. المعمارية العامة للنظام
- **Frontend & Backend:** تطبيق Monorepo باستخدام **Next.js (App Router)**.
- **Database:** قاعدة بيانات **MongoDB** (Cloud/Atlas) لإدارة البيانات.
- **Authentication:** نظام مصادقة مخصص (Cookie-based) للمسؤولين.
- **API:** نقاط اتصال RESTful داخل Next.js (`/api/*`) لمعالجة الطلبات.

## 6. التقنيات المعتمدة
- **Framework:** Next.js 16.1.1 (React 19).
- **Language:** TypeScript.
- **Styling:** TailwindCSS v4.
- **Database ORM:** Mongoose v9.
- **Icons:** Lucide React.
- **Alerts:** SweetAlert2.
- **Effects:** Canvas Confetti (لصفحة الفائز).
- **Deployment:** Vercel.

## 7. الكيانات والجداول الأساسية
1. **Code (الأكواد):**
   - `code` (string, unique): نص الكود (مثال: FX1234A).
   - `batch_name` (string): اسم الدفعة.
   - `is_used` (boolean): حالة الاستخدام.
   - `used_by` (ObjectId): مرجع للمشترك (اختياري).
2. **Participant (المشتركين):**
   - `name` (string): اسم المشترك.
   - `phone` (string): رقم الهاتف (يبدأ بـ 7، 9 أرقام).
   - `code_entered` (string): الكود المستخدم.
   - `created_at` (Date): وقت الدخول.
3. **User (المستخدمين - Admin):**
   - `username`, `password` (للدخول للوحة التحكم).

## 8. التكاملات الخارجية
- لا توجد تكاملات حالية مع بوابات SMS أو دفع (النظام يعتمد على واجهة الويب فقط).
- **Vercel:** للاستضافة والـ CI/CD.

## 9. القواعد والقرارات الثابتة
- **نظام الفرص (Logic):**
  - كود يبدأ بـ **FX** (منتج كبير) = يمنح المشترك **ثلاث فرص** (يتم إنشاء سجلين في قاعدة البيانات).
  - كود يبدأ بـ **FG** (منتج صغير) = يمنح المشترك **فرصة واحدة**.
- **صيغة الكود:** `Prefix(2) + Digits(4) + Letter(1)` (مثال: `FX9921K`).
- **التحقق من الهاتف:** يجب أن يكون يمنياً محلياً (يبدأ بـ 7 وطوله 9 أرقام).
- **تسجيل الخروج:** يتم عبر `POST` request لمسح الـ Cookies.

## 10. أشياء ممنوع تغييرها
- **عدم استخدام المحاكاة (Simulation):** يجب أن تكون جميع عمليات التسجيل حقيقية ومتصلة بقاعدة البيانات.
- **تصميم صفحة الفائز:** يجب أن يظل احتفالياً ومبهراً.
- **آلية السحب:** يجب أن تكون عشوائية تماماً من قاعدة البيانات.

## 11. المرحلة الحالية من المشروع
- **Production (Ready):** النظام جاهز ومرفوع على Vercel.
- تم تفعيل نظام الـ FX/FG وإصلاح مشاكل الـ Build والـ Logout.

## 12. خارطة الطريق المختصرة
- [x] تفعيل تسجيل المشتركين الحقيقي.
- [x] لوحة تحكم الإدارة (توليد، إحصائيات، حذف).
- [x] صفحة السحب العشوائي.
- [ ] تحسينات مستقبلية (تصدير البيانات لـ Excel، إرسال SMS للفائزين).

## 13. تعليمات سير العمل والنشر (Development Workflow)
لرفع التغييرات إلى مستودع GitHub، يجب استخدام الأوامر التالية بصيغتها المحددة لضمان التوحيد:

```bash
git add .
git commit -m "Your commit message here"
git push origin main
```
يجب ذكر هذه التعليمات في أي محادثة جديدة لضمان اتباع نفس النسق.
